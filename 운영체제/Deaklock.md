# 교착 상태 (Deadlock)

    : 프로세스들이 자원을 요구하며 서로 기다려 진행이 멈추는 상황. 교통 체증에 비유됨

- ‘식사하는 철학자 문제’로 교착 상태 설명 가능
  
  : 철학자들이 두 개의 포크를 필요로 하며, 모든 철학자가 포크를 동시에 기다릴 때 발생

- **자원 할당 그래프**
  
  - 교착 상태 발생 조건 파악 가능
  
  - 어떤 프로세스가 어떤 자원을 할당받아 사용중인지 확인 가능
  
  - 어떤 프로세스가 어떤 자원을 기다리고 있는지 확인 가능
  
  - 규칙
    
    - 프로세스는 원으로, 자원은 사각형으로 표기
    
    - 사용할 수 있는 자원의 개수는 자원 사각형 내에 점으로 표현
    
    - 프로세스가 어떤 자원을 할당 받아 사용 중이라면 자원 -> 프로세스 화살표 표시
    
    - 프로세스가 어떤 자원을 기다리고 있다면 프로세스 -> 자원 화살표 표시

- #### 교착 상태 발생 조건
  
  : 아래 4가지 조건을 모두 만족해야 교착 상태 발생
  
  - **상호 배제**: 자원은 한 프로세스가 점유하고 다른 프로세스는 사용할 수 없는 상태
  
  - **점유와 대기**: 자원을 점유한 상태에서 추가 자원을 기다리는 상황
  
  - **비선점**: 프로세스가 자원을 강제로 뺏을 수 없는 상태
  
  - **원형 대기**: 프로세스들이 자원을 원형으로 대기하며 교착 상태가 발생

- #### 교착 상태 해결 방법
  
  - **예방**
    
    : 교착 상태를 아예 발생하지 않도록 방지하는 방법(부작용 따름)
    
    - 교착 상태 발생 조건 중 하나를 없애버리기
      
      - 상호 배제 제거 : 모든 자원을 공유하게 만드는 방법이지만 현실적이지 않음
      
      - 점유와 대기 제거 : 자원을 모두 할당하거나 아예 할당하지 않음. 자원 활용도 저하 문제 있음
      
      - 비선점 조건 제거 : 자원을 강제로 회수 가능하게 함. 모든 자원에 적용 불가능(CPU같이 선점형이 가능해야 가능)
      
      - **원형 대기 제거** -> 자원에 번호를 붙여 번호 순서대로 할당
        => 자원에 번호 붙이는 것은 어려운 작업. 어떤 자원에 어떤 번호를 붙이느냐에 따라 활용률이 달라짐 (그러나, 가장 현실적이고 실용적인 방식)

- #### 교착 상태 회피
  
  - 교착 상태를 **무분별한 자원 할당으로 인해 발생**했다고 간주
  
  - 교착 상태가 발생하지 않을 만큼 조심 조심 할당하기
  
  - 배분할 수 있는 자원의 양을 고려해 교착 상태가 발생하지 않을 만큼만 자원 배분
  
  - 용어
    
    - 안전 순서열 : 교착 상태 없이 안전하게 프로세스들에 자원을 할당할 수 있는 순서
    
    - 안전 상태 : 교착 상태 없이 모든 프로세스가 자원을 할당 받고 종료될 수 있는 상태 -> 안전 순서열 있는 상태
    
    - 불안전 상태 : 교착 상태가 발생할 수도 있는 상태 -> 안전 순서열 없는 상태
  
  - 예시
    
    > - 컴퓨터 시스템에 총 12개의 자원
    > 
    > - 프로세스 P1, P2, P3가 각각 5개, 2개, 2개의 자원을 할당받아 실행 중
    > 
    > - 프로세스 P1, P2, P3는 각각 최대 10개, 4개, 9개의 자원을 요구할 수 있다고 가정
    > 
    > | 프로세스 | 요구량 | 현재 사용량 |
    > | ---- | --- | ------ |
    > | P1   | 10  | 5      |
    > | P2   | 4   | 2      |
    > | P3   | 9   | 2      |
    > 
    > - 할당한 자원 : 9, 남은 자원 : 3
    > 
    > - 안전 순서열 : P2 -> P1 -> P3
    >   
    >   - 남은 자원 중 2개 P2에 할당 -> P2 정상적으로 작업 종료 후 자원 반납
    >   
    >   - 남은 자원 5개
    >   
    >   - P1에 자원 5개 할당 -> P1 정상적으로 작업 종료 후 자원 반납
    >   
    >   - 남은 자원 : 10개
    >   
    >   - P3에 자원 7개 할당 -> 모든 프로세스 실행 가능

- 검출 후 회복
  
  : 교착 상태의 발생을 인정하고 사후에 조치하는 방식
  
  - 프로세스가 자원을 요구하면 일단 할당. 교착 상태가 검출되면 회복
  
  - 선점을 통한 회복
    
    : 교착 상태가 해결될 때까지 한 프로세스씩 자원을 몰아주는 방식
  
  - 프로세스 강제 종료를 통한 회복
    
    - 교착 상태에 놓인 프로세스 모두 강제 종료 -> 작업 내역 잃을 위험
    
    - 교착 상태가 해결될 때까지 한 프로세스씩 강제 종료 -> 오버헤드

- 교착 상태 무시
  
  - 타조 알고리즘
