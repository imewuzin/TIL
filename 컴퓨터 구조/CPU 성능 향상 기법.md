## 빠른 CPU를 위한 설계 기법

#### 클럭 속도

- CPU 속도의 단위로 사용됨
- 헤르츠(Hz)로 측정, 1초에 클럭이 반복되는 횟수를 의미
- 실제 CPU의 클럭 속도는 기가헤르츠(GHz) 단위로 측정됨
- CPU는 상황에 따라 클럭 속도를 조절할 수 있음

#### 코어와 멀티코어

- 코어: CPU 내에서 명령어를 실행하는 부품
- 멀티코어 프로세서(CPU): 여러 개의 코어를 포함한 CPU
- 코어 수에 비례해 반드시 속도가 증가하는 것은 아님

#### 스레드와 멀티스레드

- 하드웨어적 스레드: 하나의 코어가 동시에 처리하는 명령어의 단위
- 소프트웨어적 스레드: 하나의 프로그램에서 독립적으로 실행되는 단위
- 멀티스레드 프로세서: 여러 개의 하드웨어 스레드를 갖는 CPU
- 하이터스레딩 : 인텔의 멀티스레드 기술

#### 멀티스레드 프로세서 설계

- 레지스터들(편의상 레지스터 세트라고 표기)가 핵심
- 프로그램 카운터, 스택 포인터 등 여러 개의 레지스터 세트를 포함
- 하나의 코어가 여러 명령어를 동시에 처리 가능

#### 논리 프로세서

- 하드웨어 스레드를 의미
- 메모리의 프로그램이 인식하는 논리적인 CPU의 개수

---

## 명령어 병렬 처리 기법

#### 명령어 파이프라인

- 하나의 명령어 처리 과정을 여러 단계로 나눔 (인출, 해석, 실행, 저장)
- 각 단계를 동시에 실행하여 여러 명령어를 겹쳐서 처리
- 컨베이어 벨트와 유사한 방식으로 작동
- 명령어 처리 속도를 향상시킴

#### 명령어 처리 단계

1. 인출 (Fetch): 메모리로부터 명령어를 가져옴
2. 해석 (Decode): 가져온 명령어를 해석
3. 실행 (Execute): 해석한 명령어를 실행
4. 저장 (Store): 필요한 경우 결과값을 메모리에 저장

#### 특징

- 각 단계가 겹치지 않는 한 동시에 실행 가능
- 컨베이어 벨트와 유사한 방식으로 작동
- 여러 명령어를 병렬로 처리하여 전체 실행 시간 단축

#### 효과

- 명령어 처리 속도 향상
- 파이프라인을 사용하지 않을 때보다 효율적인 처리 가능

#### 파이프라인 위험

: 병령로 명령어가 올바르게 실행되지 않는 상황. 명령어 파이프라인이 성능 향상에 실패하는 경우

- 데이터 위험 : 명령어 간의 의존성에 의해 야기
  
  - 모든 명령어를 동시에 처리할 수 없다 (이전 명령어를 끝까지 실행해야만 비로소 실행할 수 있는 경우)

- 제어 위험 : 프로그램 카운터의 갑작스러운 변화로 인해 야기 (갑작스러운 메모리 주소 변경)
  
  - 분기 예측(branch prediction) : 변화 예측하는 기술

- 구조적 위험 : 서로 다른 명령어가 같은 CPU 부품(ALU, 레지스터)를 쓰려고 할 때 야기

#### 슈퍼 스칼라

: CPU 내부에 여러 개의 파이프라인을 두어 동시에 여러 명령어를 인출, 해석, 실행, 저장할 수 있는 구조

- ex) 8코어 16스레드 CPU는 한 번에 16개의 명령어를 처리 가능
- 이론적 장점 : 파이프라인 개수에 비례하여 처리 속도가 증가할 수 있지만, 관리해야 할 파이프라인이 많아지면서 파이프라인 위험도 증가

#### 비순차적 명령어 처리

: 명령어의 순서를 바꿔서 실행하는 기법으로, 파이프라인 중단을 방지. 명령어들간의 합법적인 새치기

- 특정 명령어의 실행 순서를 변경하여 파이프라인의 효율성을 높일 수 있음
- 순서를 바꾸어도 전체 프로그램 실행 흐름에 영향이 없어야 순서 바꿀 수 있음

---

#### 명령어 집합 구조 (ISA)

: CPU가 이해할 수 있는 명령어들의 모음

- 종류
  
  - **CISC (Complex Instruction Set Computer)**
    
    : 복잡한 명령어 집합을 사용하며, 다양한 기능을 제공하지만 파이프라이닝에 불리함
    - x86, x86-64는 CISC 기반 명령어 집합 구조
    
    - 명령어의 형태와 크기가 다양한 가변 길이 명령어 활용
    
    - 상대적으로 적은 수의 명령어로도 프로그램 실행 가능
    
    - 메모리를 최대한 아끼며 개발해야 했던 시절에 인기가 높았으나, 명령어 파이프라이닝이 불리하다는 치명적인 단점
    
    - 명령어가 워작 복잡하고 다양한 기능을 제공하는 탓에 명령어의 크기와 실행되기까지의 시간이 일정하지 않음
    
    - 복잡한 명령어 때문에 명령어 하나를 실행하는 데에 여러 클럭 주기 필요 
    
    - 대다수의 복잡한 명령어는 사용 빈도가 낮음
  - **RISC (Reduced Instruction Set Computer)**
    
    : 단순하고 적은 수의 명령어를 사용하여 파이프라이닝에 유리함
    - 짧고 규격화된 명령어 활용
    
    - 메모리 접근 최소화(load, store), 레지스터 십분 활용
    
    - 명령어의 종류가 적기 때문에 CISC에 비해 많은 명령어로 프로그램 실행
  
  | CISC                 | RISC                 |
  | -------------------- | -------------------- |
  | 복잡하고 다양한 명령어         | 단순하고 적은 명령어          |
  | 가변 길이 명령어            | 고정 길이 명령어            |
  | 다양한 주소 지정 방식         | 적은 주소 지정 방식          |
  | 프로그램을 이루는 명령어의 수가 적음 | 프로그램을 이루는 명령어의 수가 많음 |
  | 여러 클럭에 걸쳐 명령어 수행     | 1클럭 내외로 명령어 수행       |
  | 파이프라이닝하기 어려움         | 파이프라이닝하기 쉬움          |
